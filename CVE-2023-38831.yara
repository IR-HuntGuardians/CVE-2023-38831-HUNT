rule WinRAR_CVE202338831 {
    meta:
        Author = "Advance Threat Hunting & DFIR "
        description = "Detects WinRAR CVE-2023-38831"
        source = "https://www.group-ib.com/blog/cve-2023-38831-winrar-zero-day"

    strings:
        $suspicious_cmd = {2E ?? ?? ?? ?? 2E 63 6D 64}
        $suspicious_bat = {2E ?? ?? ?? ?? 2E 62 61 74}
        $suspicious_vbs = {2E ?? ?? ?? ?? 2E 76 62 73}
        $suspicious_wsf = {2E ?? ?? ?? ?? 2E 77 73 66}
        $suspicious_wsh = {2E ?? ?? ?? ?? 2E 77 73 68}
        $suspicious_ps1 = {2E ?? ?? ?? ?? 2E 70 73 31}
        $suspicious_js  = {2E ?? ?? ?? ?? 2E 6A 73}
        $suspicious_pif = {2E ?? ?? ?? ?? 2E 70 69 66}
        $suspicious_scf = {2E ?? ?? ?? ?? 2E 73 63 66}
        $suspicious_com = {2E ?? ?? ?? ?? 2E 63 6F 6D}
        $suspicious_hta = {2E ?? ?? ?? ?? 2E 68 74 61}
        $suspicious_dll = {2E ?? ?? ?? ?? 2E 64 6C 6C}
        $suspicious_exe = {2E ?? ?? ?? ?? 2E 65 78 65}
        $suspicious_scr = {2E ?? ?? ?? ?? 2E 73 63 72}
        $suspicious_ws_wsf  = {2E ?? ?? ?? ?? 2E 77 73 ??}
        $suspicious_vb_vba_vbs = {2E ?? ?? ?? ?? 2E 76 62 ??}
    condition:
     // Check for the "PK" magic number at the start of the file
        uint16(0) == 0x4B50
        and any of ($suspicious_*)
}  